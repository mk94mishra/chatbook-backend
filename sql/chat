
2. chat group1 tbl as view

create view tbl_chat_group1 as ( 
select distinct on (group_id) group_id, 
msg as last_msg,created_at,
sender_id, receiver_id,
case when (sender_id<receiver_id)  then sender_id else receiver_id end as user_id_min,
case when (sender_id>receiver_id)  then sender_id else receiver_id end as user_id_max,
is_seen_min, is_seen_max,
is_deleted_min, is_deleted_max
from tbl_chat_msg order by group_id, created_at desc
)


3. chat group with user profile

create view tbl_chat_group as ( select 
cg1.*,
 umin.username as name_min, umin.profile_pic_url as profile_pic_url_min,
 umax.username as name_max, umax.profile_pic_url as profile_pic_url_max
from tbl_chat_group1 as cg1
left join tbl_user as umin on cg1.user_id_min=umin.id
left join tbl_user as umax on cg1.user_id_max=umax.id
)


4. chat user

select
user_id_max as user_id, profile_pic_url_max as profile_pic_url, name_max as "name", last_msg, is_seen_min as is_seen, created_at
from tbl_chat_group where user_id_min=5 
union 
select
user_id_min as user_id, profile_pic_url_min as profile_pic_url, name_min as "name", last_msg, is_seen_max as is_seen, created_at
from tbl_chat_group where user_id_max=5 

